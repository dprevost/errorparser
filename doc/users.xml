<?xml version='1.0'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN" "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">
<book>

  <title>Error Parser Users' Manual</title>

  <bookinfo>

    <title>Error Parser Users' Manual</title>

    <author><firstname>Daniel</firstname><surname>Pr&eacute;vost</surname></author>

    <copyright><year>2008-2009</year><holder>Daniel 
    Pr&eacute;vost</holder></copyright>
    <releaseinfo>This manual is for release 1.1 of Error Parser</releaseinfo>
  </bookinfo>

  <chapter id="Introduction">

    <title>Introduction</title>

    <para>
      Error Parser is a small tool for application developers. It simplifies 
      the management of error codes, error messages and documentation for
      both small and large projects.
    </para>
    <para>
      This is accomplished by creating a master XML file containing all the
      necessary information on the errors (value, error message and 
      documentation). Error Parser uses this file to generate the 
      appropriate output files for different programming languages.
    </para>
    <para>
      Control of the code generation is done by an option file written in XML.
      The format for both XML files is explained below.
    </para>
  </chapter>
  
  <chapter id="New">

    <title>New in this release</title>
  
    <para> 
      This release is a minor update - support for Java was added.
    </para>

  </chapter>
    
  <chapter id="user_guide">

    <title>User Guide</title>

    <sect1 id="intro">

      <title>Introduction</title>

      <para>
        The program errorParser is very easy to use. From the 
        command line just enter:
      </para>

      <programlisting>errorParser -o <varname>option_file</varname> <varname>error_file</varname></programlisting>
      <para>
        where <varname>option_file</varname> and 
        <varname>error_file</varname> are the names of two xml files 
        specifying the options and all the data associated with the 
        errors. The real complexity is of course in the xml files 
        themselves. There are examples of these files in the distribution
        directory and their syntax is explained below.
      </para>
      
      <para>
        The program can also be called with a single option:
        <itemizedlist>
          <listitem>
            <para>
              -h, -? or --help
            </para>
            <para>
              will give you the list of options and the syntax of the program.
            </para>
          </listitem>
          <listitem>
            <para>
              -v or --version
            </para>
            <para>
              will tell you which version you are using (new since version 1.0).
            </para>
          </listitem>
        </itemizedlist>
      </para>
      
    </sect1>

    <sect1 id="xml_file">

      <title>The xml error file</title>

      <para> 
        This section documents version 1.3 of the DTD. 
      </para>
      <para>
        The xml file starts with the usual xml header (version of 
        xml, encoding of the file, the location of the DTD, etc.). If 
        you&apos;re not familiar with xml and want more information on 
        this, you might want to read additional documentation, for 
        example the web site of the 
        <ulink url="http://www.w3schools.com/xml/default.asp">
          W3 Schools
        </ulink>.
      </para>
      <para>
        Each of the xml tag specific to Error Parser is explained 
        in the list below. Unless specified, each tag can only appear 
        once (for each of its parent) and in the order listed here. 
        Example: the &lt;years&gt; tag must be the first sub-tag of 
        &lt;copyright&gt; and must be unique - however, if you have more 
        than one &lt;copyright&gt; tag, each will have its &lt;years&gt; 
        sub-tag.
      </para>

      <itemizedlist>
        <listitem>
          <para>
            &lt;errorlist version=&quot;0.3&quot;&gt; 
            <indexterm><primary>errorlist</primary></indexterm>
          </para>
          <para>
            This tag starts the document itself (the root element). 
            The version attribute is a string of your choosing and is there 
            to help you synchronize your work. 
            You can use it to make sure that the output
            files match the version of your software, for example. 
            This attribute is optional.
          </para>
        </listitem>
        <listitem>
          <para>
            &lt;copyright_group&gt; 
            <indexterm><primary>copyright_group</primary></indexterm>
          </para>
          <para>
            This is an optional tag. You use it if you want to 
            generate copyright information and the terms of the license
            in the output files. 
            This tag has only one sub-tag, &lt;copyright&gt;, which can be 
            repeated multiple times (if you have multiple authors with 
            possibly different licenses).
          </para>
        </listitem>
        <listitem>
          <para>
            &lt;copyright&gt; 
            <indexterm><primary>copyright</primary></indexterm>
          </para>
          <para>
            Allows you to enter copyright information in the output 
            files. It has multiple sub-tags. As mentioned previously, 
            multiple &lt;copyright&gt; tags are allowed.
          </para>
          <itemizedlist>
            <listitem>
              <para>
                &lt;years&gt;
                <indexterm><primary>years</primary></indexterm>
              </para>
              <para>
                The interval of years for the current copyright notice.
              </para>
            </listitem>
            <listitem>
              <para>
                &lt;authors&gt;
                <indexterm><primary>authors</primary></indexterm>
              </para>
              <para>
                The name(s) of the owner(s) of the copyright.
              </para>
            </listitem>
            <listitem>
              <para>
                &lt;license_para&gt;
                <indexterm><primary>license_para</primary></indexterm>
              </para>
              <para>
                This tag contains a single paragraph of the terms of your license. 
                Use multiple &lt;license_para&gt; if your 
                license has multiple paragraphs. You must have at least 
                one &lt;license_para&gt; for each &lt;copyright&gt;.
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
            &lt;errgroup&gt;
            <indexterm><primary>errgroup</primary></indexterm>
          </para>
          <para>
            &lt;errgroup&gt; is used to organize your errors in 
            groups, if you so desire. For example, you could split your
            errors in a group of i/o errors, a group of network errors, etc. 
            You can have multiple &lt;errgroup&gt; but you must have at least one.
          </para>
          <para>
            If you don&apos;t want to use this feature, use a 
            single group and do not include the &lt;errgroup_ident&gt; 
            sub-tag.
          </para>
        </listitem>
        <listitem>
          <para>
            &lt;errgroup_ident&gt;
            <indexterm><primary>errgroup_ident</primary></indexterm>
          </para>
          <para>
            This sub-tag of &lt;errgroup&gt; is optional. The 
            sub-tags associated with this tag are used to generate 
            comments in your output header file (and will be used to 
            generate the DocBook documentation eventually).
          </para>
          <para>
            You can have multiple &lt;errgroup_ident&gt; - one for 
            each language supported by your application. This is done 
            with an optional attribute, xml:lang. If the xml:lang 
            attribute is missing, the default attribute will be used.
            The default attribute is &apos;en&apos;. You can modify it
            by editing the shipped DTD.
          </para>
          <para>
            Note: the parser will use the first 
            &lt;errgroup_ident&gt; matching the language selected in the 
            option file. If the selected language is not found, the first 
            &lt;errgroup_ident&gt; is used.
          </para>
          <itemizedlist>
            <listitem>
              <para>
                &lt;errgroup_name&gt;
                <indexterm><primary>errgroup_name</primary></indexterm>
              </para>
              <para>
                A name for this group of errors. For example, Network errors.
              </para>
            </listitem>
            <listitem>
              <para>
                &lt;errgroup_desc&gt;
                <indexterm><primary>errgroup_desc</primary></indexterm>
              </para>
              <para>
                Description of this group of errors. You must have 
                at least one &lt;errgroup_desc&gt; or more as needed.
                Each will be mapped to a paragraph.
              </para>
            </listitem>
          </itemizedlist>
        </listitem>
        <listitem>
          <para>
            &lt;error&gt;
            <indexterm><primary>error</primary></indexterm>
          </para>
          <para>
            This tag is also a sub-tag of &lt;errgroup&gt;. You 
            need at least one &lt;error&gt; for each &lt;errgroup&gt; but 
            you can have as many as needed.
          </para>
          <itemizedlist>
            <listitem>
              <para>
                &lt;errnumber&gt;
                <indexterm><primary>errnumber</primary></indexterm>
              </para>
              <para>The numerical value of the error code.</para>
            </listitem>
            <listitem>
              <para>
                &lt;errname&gt;
                <indexterm><primary>errname</primary></indexterm>
              </para>
              <para>
                The generic name of the error. This name is going 
                to be used to generate either an enum entry or a #define 
                in the output header file.
              </para>
              <para>
                Note: if you add a prefix to your errors (to avoid 
                namespace conflicts), it is recommended to leave the 
                prefix out. For example, PSO_OBJECT_IS_DELETED would 
                become &lt;errname&gt; OBJECT_IS_DELETED &lt;/errname&gt; 
                - the prefix can be added by specifying it in the option 
                file.
              </para>
            </listitem>
            <listitem>
              <para>
                &lt;message_group&gt;
                <indexterm><primary>message_group</primary></indexterm>
              </para>
              <para>
                This tag is used to group the error messages and 
                the documentation for the error - which are encapsulated 
                in the &lt;message&gt; tag. Multiple &lt;message&gt; tags 
                are supported (you must have at least one), one for each 
                supported language.
              </para>
            </listitem>
            <listitem>
              <para>
                &lt;message&gt;
                <indexterm><primary>message</primary></indexterm>
              </para>
              <para>
                Container for both the error message and the 
                documentation for this error. This tag has an optional 
                attribute, xml:lang. If the xml:lang attribute is missing 
                the default attribute will be used.
                The default attribute is &apos;en&apos;. You can modify it
                by editing the shipped DTD.
              </para>
              <para>
                You must have at least one &lt;message&gt;, 
                multiple ones are supported (one per language used in 
                your application).
              </para>
              <para>
                Note: the parser will use the first &lt;message&gt; 
                matching the language selected in the option file. If the 
                selected language is not found, the first &lt;message&gt; 
                is used.
              </para>
              <itemizedlist>
                <listitem>
                  <para>
                    &lt;errormsg&gt;
                    <indexterm><primary>errormsg</primary></indexterm>
                  </para>
                  <para>
                    This tag identifies the text of the error message that 
                    will be retrieved by the function 
                    <emphasis>yourprefix_ErrorMessage()</emphasis>.
                  </para>
                  <para>
                    Note: the inclusion of some characters 
                    (&apos;%&apos; for example) or chain of characters 
                    (escape sequences) might be problematic. You can 
                    control how Error Parser will handle these 
                    occurrences by setting the appropriate options in the 
                    option file.
                  </para>
                </listitem>
                <listitem>
                  <para>
                    &lt;errordoc&gt;
                    <indexterm><primary>errordoc</primary></indexterm>
                  </para>
                  <para>
                    Each &lt;errordoc&gt; is a paragraph of the 
                    documentation. Therefore, you can have multiple 
                    &lt;errordoc&gt; but you must have at least one.
                  </para>
                </listitem>
              </itemizedlist>
            </listitem>
          </itemizedlist>
        </listitem>
      </itemizedlist>
      <para />

    </sect1>

    <sect1 id="option_file">

      <title>The xml option file </title>

      <para>
        This section documents version 2.1 of the DTD. This new release of
        the parser will understand version 2.0 of the DTD.
        Current option files based on version 1.* must be upgraded.
      </para>

      <itemizedlist>

        <listitem>
          <para>
            &lt;options version="2.2"&gt;
            <indexterm><primary>options</primary></indexterm>
          </para>
          <para>
            This tag starts the document itself (the root element). The 
            attribute "version" (the version of the DTD) is required; it 
            is used by the parser to support multiple versions 
            of the DTD (starting at version 2.0), as needed.
          </para>
        </listitem>

        <listitem>
          <para>
            &lt;general_options&gt;
            <indexterm><primary>general_options</primary></indexterm>
          </para>
          <para>
            Options with a global impact or that will influence the
            processing of more than one output file.
          </para>

          <itemizedlist>

            <listitem>
              <para>
                &lt;prefix_error_no_namespace&gt;
                <indexterm><primary>prefix_error_no_namespace</primary></indexterm>
              </para>
              <para>
                The prefix to be used for the error codes (enum or 
                #define). For example, if your error is OBJECT_IS_DELETED 
                (using the &lt;errname&gt; tag) and your prefix is PSO, the error
                code becomes PSO_OBJECT_IS_DELETED.
              </para>
              <para>
                The prefix is currently used in the error-message files and in
                the main header file. It is not used in C# or Python since
                these languages support namespaces (prefixes like this are
                used to avoid namespace clashes in languages without a
                namespace, for example C).
              </para>
            </listitem>
          
            <listitem>
              <para>
                &lt;selected_lang&gt;
                <indexterm><primary>selected_lang</primary></indexterm>
              </para>

              <para>
                Optional parameter to select the language that will be used for
                the documentation and error messages. If absent, the first 
                &lt;message&gt; tag will be used.
              </para>
              <para>
                For each error, if there are no &lt;message&gt; for the selected 
                language, the first &lt;message&gt; tag will be used.
              </para>
              <para>
                The chosen language is specified using the xml:lang attribute. 
                For example:
              </para>
              <para>
                <programlisting>&lt;selected_lang xml:lang=&quot;en&quot;/&gt;</programlisting>
              </para>
            </listitem>

          </itemizedlist>

        <!-- End of general options -->
        </listitem>

        <listitem>
          <para>
            &lt;header_file&gt;
            <indexterm><primary>header_file</primary></indexterm>
          </para>
          <para>
            Optional. Options for the main header file.
          </para>
        
          <itemizedlist>
        
            <listitem>
              <para>
                &lt;header_enum&gt;
                <indexterm><primary>header_enum</primary></indexterm>
              </para>
              <para>
                Optional. The name of the enum. If absent, #define will 
                be generated instead.
              </para>
            </listitem>

            <listitem>
              <para>
                &lt;header_dirname&gt;
                <indexterm><primary>header_dirname</primary></indexterm>
              </para>
              <para>
                Optional. The name of the directory where the error 
                header file is to be created. If absent, the current 
                directory or the directory specified by &lt;header_name&gt; 
                will be used.
              </para>
              <para>
                Alternatively, you can put the directory name (or part 
                of the directory name) directly in the &lt;header_name&gt; 
                tag. But if you do, the &quot;guard&quot;<footnote>
                <para>
                  guard: a small chunk of preprocessor code used 
                to avoid including the same header file twice.
                </para></footnote>
                will include that 
                directory name.
              </para>
              <para>
                Example: the output file name is 
                <emphasis>my_dir/my_sub_dir/my_sub_project/errors.h</emphasis> 
                and you want to include <emphasis>my_sub_project</emphasis> 
                in the guard. The option file would look like:
              </para>
              <para>
                <programlisting>&lt;header_dirname&gt;my_dir/my_sub_dir&lt;/header_dirname&gt;
&lt;header_name&gt;my_sub_project/errors.h&lt;/header_name&gt;
                </programlisting>
              </para>
              <para>The generated guard would look like this:</para>
              <para>
                <programlisting>#ifndef MY_SUB_PROJECT_ERRORS_H
#define MY_SUB_PROJECT_ERRORS_H
...
#endif /* MY_SUB_PROJECT_ERRORS_H */
                </programlisting>
              </para>
            </listitem>

            <listitem>
              <para>
                &lt;header_name&gt;
                <indexterm><primary>header_name</primary></indexterm>
              </para>
              <para>
                The name of the header file for errors. See the 
                item &lt;header_dirname&gt; for a discussion on names of files,
                directories and the generated header guard.
              </para>
            </listitem> 
        
          </itemizedlist>

        <!-- End of main header file options -->
        </listitem>
        
        <listitem>
          <para>
            &lt;errmsg_files&gt;
            <indexterm><primary>errmsg_files</primary></indexterm>
          </para>
          <para>
            Optional. Options for the error-message files (.c and .h).
          </para>
      
          <itemizedlist>

            <listitem>
              <para>
                &lt;errmsg_dirname&gt;
                <indexterm><primary>errmsg_dirname</primary></indexterm>
              </para>
              <para>
                Optional. The name of the directory where the header file 
                will be created. If absent, the current directory or the 
                directory specified by &lt;errmsg_header_name&gt; will be 
                used.
              </para>
              <para>
                See the item &lt;header_dirname&gt; for a discussion on names 
                of files, directories and the generated header guard.
              </para>
            </listitem>
        
            <listitem>
              <para>
                &lt;errmsg_header_name&gt;
                <indexterm><primary>errmsg_header_name</primary></indexterm>
              </para>
              <para>
                The name of the header file for the code to retrieve 
                the error messages. 
                See the item &lt;header_dirname&gt; for a discussion on names 
                of files, directories and the generated header guard.
              </para>
            </listitem>
            
            <listitem>
              <para>
                &lt;errmsg_c_fullname&gt;
                <indexterm><primary>errmsg_c_fullname</primary></indexterm></para>
              <para>
                The full name of the &quot;C&quot; file for the code to 
                retrieve the error messages (note: the path can be relative
                to the current working directory).
             </para>
            </listitem>
    
            <listitem>
              <para>
                &lt;errmsg_options&gt;
                <indexterm><primary>errmsg_options</primary></indexterm></para>
                <indexterm><primary>build_dll</primary></indexterm>
              <para>
                Optional. This tag has no content and a single attribute, 
                build_dll.
                The attribute is an enumeration with two values, yes and no. 
                The default is no. Set it to yes if you are building a DLL on
                Microsoft Windows and you want to access the error-message
                function from outside the DLL.
              </para>
              <para>
                If you are setting the attribute to yes on other platforms it
                will generate an empty macro, in other words no side effects.
                However, if you are building a self-contained EXE on Windows,
                Visual Studio will warn you about this.
              </para>
            </listitem>
            
            <listitem>
              <para>
                &lt;errmsg_prefix_var&gt;
                <indexterm><primary>errmsg_prefix_var</primary></indexterm>
              </para>
              <para>
                The prefix to be used for all variables in the code to 
                retrieve the error messages.
              </para>
            </listitem>

            <listitem>
              <para>
                &lt;errmsg_msg&gt;
                <indexterm><primary>errmsg_msg</primary></indexterm>
              </para>

              <para>
                This tag has no content but its attributes are 
                important - they define the allowed characteristics (and the 
                transformations, if needed) of the error messages defined in 
                the xml error file (&lt;errormsg&gt;).
              </para>

              <para>
                The problem: the generated C strings will be used, 
                eventually, by standard C/C++ libraries and some sequence of 
                characters could have negative side effects. 
                The most problematic character is likely the % symbol - it 
                is interpreted differently by libc (printf()) 
                and the iostream library (cout).
              </para>
              <para>The attributes:</para>
              <itemizedlist>
                <listitem>
                  <para>
                    allow_escapes
                    <indexterm>
                      <primary>allow_escapes</primary>
                      <secondary>escape</secondary>
                    </indexterm>
                  </para>
                  <para>
                    An enumeration with two values, yes and no. The 
                    default is no; escape sequences are not permitted.
                  </para>
                  <para>
                    Note: if you want to allow quotes in your messages, do 
                    <emphasis> NOT </emphasis> escape them if allow_escapes
                    is set to no (they will be escaped by Error Parser).
                  </para>
                </listitem>
                <listitem>
                  <para>
                    allow_quotes 
                    <indexterm>
                      <primary>allow_quotes</primary>
                      <secondary>quotes</secondary>
                    </indexterm>
                  </para>
                  <para>
                    An enumeration with two values, yes and no. The 
                    default is yes; quotes (&apos; and &quot;) are allowed 
                    and will be escaped as needed.
                  </para>
                </listitem>
                <listitem>
                  <para>
                    percent
                    <indexterm><primary>percent</primary></indexterm>
                  </para>
                  <para>
                    The text that will be used to replace the % symbol. 
                    This attribute is mandatory and has no default value.
                    The textual &quot;percent&quot; is recommended.
                  </para>
                </listitem>
              </itemizedlist>
            </listitem>

          </itemizedlist>
        <!-- End of options for error-message files -->
        </listitem>

        <listitem>
          <para>
            &lt;csharp&gt;
            <indexterm><primary>c#</primary></indexterm>
            <indexterm><primary>csharp</primary></indexterm>
          </para>
          <para>
            Optional. If present, code for C# will be generated (in the
            form of an enum). Additional sub-tags, described below, are used 
            to provide the required parameters.
          </para>

          <itemizedlist>
            <listitem>
              <para>
                &lt;cs_filename&gt;
                <indexterm><primary>cs_filename</primary></indexterm>
              </para>
              <para>
                Full or relative path to the generated C# code.
              </para>
            </listitem>

            <listitem>
              <para>
                &lt;cs_enum_name&gt;
                <indexterm><primary>cs_enum_name</primary></indexterm>
              </para>
              <para>
                The name of the C# enum.
              </para>
            </listitem>
    
            <listitem>
              <para>
                &lt;cs_namespace&gt;
                <indexterm><primary>cs_namespace</primary></indexterm>
              </para>
              <para>
                Optional. The name of the C# namespace. If absent, the code
                is generated without a namespace.
              </para>
            </listitem>

          </itemizedlist>
        </listitem>

        <listitem>
          <para>
            &lt;ext_py&gt;
            <indexterm><primary>ext_py</primary></indexterm>
          </para>
          <para>
            Optional. If present, a C header file, to be used by a Python 
            extension module, will be generated. 
            Additional sub-tags,described below, are used 
            to provide the required parameters.
          </para>
          <para>
            The code generates a C function to create 2 dict (associated arrays)
            objects. The key for the first dict is the error symbolic name and
            the value is the error number. The key for the second dict is 
            the error number and the value is the symbolic name.
          </para>
          <para>
            Example of use in Python (taken from the tests of Photon):
          </para>
          <para>
            <programlisting>    try:
        s.create_object( '', pso.BaseDef(pso.FOLDER, 0) )
    except pso.error, (msg, errcode):
        if errcode != pso.errs['INVALID_LENGTH']:
            print 'error = ', pso.errnames[errcode]
            print msg
            raise
            </programlisting>
          </para>
          <para>
            In this example, pso.errs and pso.errnames are the two dict 
            used by the
            Photon extension module. See the section
            <quote><link linkend='example_python_extended_module' 
              endterm="example_python_extended_module.title"/></quote>
            for some tips on how to use the generated file in your C code.
          </para>

          <itemizedlist>
          
            <listitem>
              <para>
                &lt;ext_py_dirname&gt;
                <indexterm><primary>ext_py_dirname</primary></indexterm>
              </para>
              <para>
                Optional. The name of the directory where the code should be
                generated. If absent, the current directory or the 
                directory specified by &lt;ext_py_filename&gt; will be used.
              </para>
              <para>
                See the item &lt;header_dirname&gt; for 
                a discussion on names of files, directories and the 
                generated header guard.
              </para>
            </listitem>

            <listitem>
              <para>
                &lt;ext_py_filename&gt;
                <indexterm><primary>ext_py_filename</primary></indexterm>
              </para>
              <para>
                The name of the header file.
                See the item &lt;header_dirname&gt; for a discussion on names 
                of files, directories and the generated header guard.
              </para>
            </listitem>

            <listitem>
              <para>
                &lt;ext_py_function&gt;
                <indexterm><primary>ext_py_function</primary></indexterm>
              </para>
              <para>
                Optional. The name of the generated function. If absent, the
                code will use AddErrors().
              </para>
            </listitem>

          </itemizedlist>
        </listitem>

        <listitem>
          <para>
            &lt;pure_python&gt;
            <indexterm><primary>pure_python</primary></indexterm>
          </para>
          <para>
            Optional. If present, a Python file will be generated. 
            Additional sub-tags, described below, are used 
            to provide the required parameters.
          </para>
          <para>
            The code generates a Python function to create 2 dict (associated arrays)
            objects. The key for the first dict is the error symbolic name and
            the value is the error number. The key for the second dict is 
            the error number and the value is the symbolic name.
          </para>

          <itemizedlist>

            <listitem>
              <para>
                &lt;pure_py_filename&gt;
                <indexterm><primary>pure_py_filename</primary></indexterm>
              </para>
              <para>
                The name of the Python generated file.
              </para>
            </listitem>

            <listitem>
              <para>
                &lt;pure_py_function&gt;
                <indexterm><primary>pure_py_function</primary></indexterm>
              </para>
              <para>
                Optional. The name of the generated function. If absent, the
                code will use add_errors().
              </para>
            </listitem>

          </itemizedlist>
        </listitem>
   
        <listitem>
          <para>
            &lt;java&gt;
            <indexterm><primary>java</primary></indexterm>
          </para>
          <para>
            Optional. If present, a Java file will be generated. 
            Additional sub-tags, described below, are used 
            to provide the required parameters.
          </para>
          <para>
            The code generates a Java enum class. Java 5.0 or greater is 
            required.
          </para>

          <itemizedlist>

            <listitem>
              <para>
                &lt;java_filename&gt;
                <indexterm><primary>java_filename</primary></indexterm>
              </para>
              <para>
                The name of the Java generated file.
              </para>
            </listitem>
          
            <listitem>
              <para>
                &lt;java_enum_name&gt;
                <indexterm><primary>java_enum_name</primary></indexterm>
              </para>
              <para>
                The name of the Java enum.
              </para>
            </listitem>

            <listitem>
              <para>
                &lt;java_package&gt;
                <indexterm><primary>java_package</primary></indexterm>
              </para>
              <para>
                Optional. The name of the Java package.
              </para>
            </listitem>

          </itemizedlist>
        </listitem>
   
      </itemizedlist>

    </sect1>

    <sect1 id="quasar">
  
      <title>Example: the Photon software</title>

      <para>
        Photon is a framework: it includes a library with interfaces in C,
        C++, C# and Python and a few standalone executables. Error Parser
        is used for the library and generates output files for all the
        different interfaces. It is also used for the Photon server,
        Quasar, but in a more limited fashion.
      </para>
      <para>
        Photon uses the GNU toolchain on Linux/Unix. As such, this example
        might not be very useful if you use a different approach 
        (Visual Studio only, Eclipse, etc.). 
      </para>
      <para>
        It should be noted that the Error Parser program is not needed
        to build Photon. The output files generated by Error Parser are
        included in the source code distribution. However, Error Parser 
        is required for developers and maintainers of the framework.
      </para>

      <sect2 id="configure.ac">

        <title>configure.ac</title>
    
        <para>
          The autoconf program is used by the photon framework to determine
          multiple aspects of the current system: the operating system,
          the hardware, the availability of some C functions, of some 
          programs, etc. Error Parser is one of these programs.
        </para>
        <para>
          To tell autoconf to look for Error Parser, the following lines must 
          be added to the file configure.ac:
          <programlisting>
# Tell our makefiles that we can use errorParser to regenerate the error
# handling code, as needed.
AC_CHECK_PROG([ERRORPARSER_IS_PRESENT], [errorParser], [yes], [no])
AM_CONDITIONAL([COND_USE_ERRORPARSER], [test "$ERRORPARSER_IS_PRESENT" = yes])
          </programlisting>
        </para>
        <para>
          If Error Parser is not present on the system, the automake 
          conditional COND_USE_ERRORPARSER will be false and the Makefile
          will not attempt to regenerate the error output files even if the 
          xml error file itself is modified.
        </para>

      </sect2>

      <sect2 id="makefile_am">

        <title>Makefile.am</title>

        <para>
          Including the rules for the parser in a Makefile is relatively simple. 
          Here is a code snippet from the Makefile.am of Quasar; the syntax for
          ordinary makefiles should be similar.
        </para>
       
        <programlisting># The main target, quasar
bin_PROGRAMS = quasar

# The list of files generated by errorParser.
OUTPUT_FILES =               \
        quasarErrors.h       \
        quasarErrorHandler.c \
        quasarErrorHandler.h 

# This is "true" if the autoconf program found errorParser. Otherwise
# we will not attempt to redo the generated files.
if COND_USE_ERRORPARSER
$(OUTPUT_FILES): quasarOptions.xml quasarErrors.xml
	errorParser --options quasarOptions.xml quasarErrors.xml
endif

# The source code needed to build quasar. We list the errorParser 
# generated files first since they must be "refreshed" first since they
# might be used in the rest of the code (certainly true for quasarErrors.h).
quasar_SOURCES =             \
        $(OUTPUT_FILES) \
        Acceptor.cpp    \
        ...
        </programlisting>
      </sect2>

      <sect2 id="option_files_examples">
      
        <title> Option files</title>

        <para>
          Two examples are shown here. The file option.xml is used for the
          library of Photon. It uses most of the features of Error Parser,
          including the generation of code for C# and Python extension module.
          In contrast, quasarOptions.xml is based on a smaller subset of
          available features.
        </para>
        
        <sect3 id="options_xml">
        
          <title>options.xml</title>
        
          <programlisting>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE options PUBLIC
    "-//Error Parser project//DTD Error Parser Options XML V2.2//EN"
    "http://errorparser.sourceforge.net/xml/errorParserOptions22.dtd"&gt;

&lt;!-- 
   This xml file provides the options needed by errorParser.
   It must be used in conjonction with photon.xml.
   
   Generated output: 
     - header file photon/psoErrors.h.
     - the code to retrieve the error messages
     - a C# enum
     - a header file for the pso extension module (python).
--&gt;

&lt;options version="2.2"&gt;

  &lt;general_options&gt;
    &lt;!-- Prefix to be used for the error codes. --&gt;
    &lt;prefix_error_no_namespace&gt; PSO &lt;/prefix_error_no_namespace&gt;
    &lt;selected_lang xml:lang="en" /&gt;
  &lt;/general_options&gt;
  
  &lt;header_file&gt;
    &lt;!-- The name of the enum. --&gt;
    &lt;header_enum&gt; psoErrors &lt;/header_enum&gt;
    &lt;!-- Name of the output dir for the error header file. --&gt;
    &lt;header_dirname&gt; ../include/photon &lt;/header_dirname&gt;
    &lt;!-- The file name for the .h file which will hold the errors. --&gt;
    &lt;header_name&gt; psoErrors.h &lt;/header_name&gt;
  &lt;/header_file&gt;
  
  &lt;errmsg_files&gt;
    &lt;!-- Name of the output dir for the code to retrieve the error messages. --&gt;
    &lt;errmsg_dirname&gt; ../Nucleus &lt;/errmsg_dirname&gt;
    &lt;!-- The file name for the .h file for the code to retrieve the error 
         messages. --&gt;
    &lt;errmsg_header_name&gt; psoErrorHandler.h &lt;/errmsg_header_name&gt;
    &lt;!-- The file name for the .c file for the code to retrieve the error 
         messages. --&gt;
    &lt;errmsg_c_fullname&gt; ../Nucleus/psoErrorHandler.c &lt;/errmsg_c_fullname&gt;
    &lt;errmsg_options build_dll="yes"/&gt;
    &lt;!-- Prefix to be used for all variables in the code to retrieve the 
         error messages --&gt;
    &lt;errmsg_prefix_var&gt; pson &lt;/errmsg_prefix_var&gt;
    &lt;errmsg_msg percent="percent"/&gt;
  &lt;/errmsg_files&gt;

  &lt;!-- Optional section for creating an enum for C# --&gt;
  &lt;csharp&gt;
    &lt;!-- Full or relative path to the generated C# code --&gt;
    &lt;cs_filename&gt; ../CS/PhotonLib/Errors.cs &lt;/cs_filename&gt;
    &lt;cs_enum_name&gt; PhotonErrors &lt;/cs_enum_name&gt;
    &lt;!-- The namespace is optional --&gt;
    &lt;cs_namespace&gt; Photon &lt;/cs_namespace&gt;
  &lt;/csharp&gt;

  &lt;!-- Optional section for Python (extension module) --&gt;
  &lt;ext_python&gt;
    &lt;ext_py_dirname&gt; ../Python/src &lt;/ext_py_dirname&gt;
    &lt;ext_py_filename&gt; errors.h &lt;/ext_py_filename&gt;
  &lt;/ext_python&gt;
  
&lt;/options&gt;
          </programlisting>
          
        </sect3>
        
        <sect3 id="quasaroptions">

          <title>quasarOptions.xml</title>

          <programlisting>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE options SYSTEM 
             "/usr/local/share/xml/errorParser/errorParserOptions22.dtd"&gt;

&lt;!-- This xml file provides the options to the errorParser program. --&gt;

&lt;options version="2.2"&gt;

  &lt;!-- Section for all general options. --&gt;
  &lt;general_options&gt;
    &lt;!-- Prefix to be used for the error codes (enum or #define). --&gt;
    &lt;prefix_error_no_namespace&gt; PSOQ &lt;/prefix_error_no_namespace&gt;
    &lt;selected_lang xml:lang="en" /&gt;
  &lt;/general_options&gt;

  &lt;!-- Section for the main header file. --&gt;
  &lt;header_file&gt;  
    &lt;!-- The name of the enum. --&gt;
    &lt;header_enum&gt; psoqErrors&lt;/header_enum&gt;
    &lt;!-- The file name for the .h file which will hold the errors. --&gt;
    &lt;header_name&gt; quasarErrors.h &lt;/header_name&gt;
  &lt;/header_file&gt;

  &lt;!-- Section for the error message files. --&gt;
  &lt;errmsg_files&gt;
    &lt;!-- The file name for the .h file for the code to retrieve the error 
         messages. --&gt;
    &lt;errmsg_header_name&gt; quasarErrorHandler.h &lt;/errmsg_header_name&gt;
    &lt;!-- The file name for the .c file for the code to retrieve the error 
         messages. --&gt;
    &lt;errmsg_c_fullname&gt; quasarErrorHandler.c &lt;/errmsg_c_fullname&gt;
    &lt;!-- Options for the error message --&gt;
    &lt;errmsg_options build_dll="no" /&gt;
    &lt;!-- Prefix to be used for all variables in the code to retrieve the 
        error messages --&gt;
    &lt;errmsg_prefix_var&gt; psoq &lt;/errmsg_prefix_var&gt;
    &lt;errmsg_msg percent="percent" /&gt;
  &lt;errmsg_files&gt;
  
&lt;/options&gt;
          </programlisting>
        </sect3>
      </sect2>

      <sect2 id="quasarerrors">

        <title>The Error File</title>
    
        <para>
          This is a short version of the error file used by Quasar, the Photon
          server:
        </para>
        
        <programlisting>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE errorlist PUBLIC "-//Error Parser project//DTD Error Parser XML V1.3//EN"
             "http://errorparser.sourceforge.net/xml/errorParser13.dtd"&gt; 
&lt;!-- 
    This file contains the error codes specific to the server of
    Photon, quasar.
    
    You can replace the DOCTYPE with this, if you prefer:
&lt;!DOCTYPE errorlist SYSTEM 
             "/usr/local/share/xml/errorParser/DTD/errorParser13.dtd"&gt;
    
--&gt;

&lt;!-- Photon next version is 0.4 --&gt;
&lt;errorlist version="0.4"&gt;
  &lt;!-- Copyright information and any additional info that will appear at 
       the top of the generated files. This is optional. --&gt;
  &lt;copyright_group&gt;
    &lt;copyright&gt;
      &lt;years&gt;2006-2008&lt;/years&gt;
      &lt;authors&gt;Daniel Prevost&lt;/authors&gt;
      &lt;!-- Each &lt;license_para&gt; is mapped to a paragraph (easier to read) --&gt;
      &lt;license_para&gt;
        This file is part of the Photon framework.
      &lt;/license_para&gt;
      &lt;!-- The GPL license is of course for Photon, not for Error Parser... --&gt;
      &lt;license_para&gt;
        This file may be distributed and/or modified under the terms of the
        GNU General Public License version 2 as published by the Free Software
        Foundation and appearing in the file COPYING included in the
        packaging of this library.
      &lt;/license_para&gt;
      &lt;license_para&gt;
        This library is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
      &lt;/license_para&gt;
    &lt;/copyright&gt;
  &lt;/copyright_group&gt;
  &lt;errgroup&gt;
    &lt;error&gt;
      &lt;errnumber&gt; 0 &lt;/errnumber&gt;
      &lt;errname&gt; OK &lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;No error...&lt;/errormsg&gt;
          &lt;errordoc&gt;No error...&lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 1 &lt;/errnumber&gt;
      &lt;errname&gt; NOT_ENOUGH_HEAP_MEMORY &lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;
            Not enough heap memory (non shared memory). 
          &lt;/errormsg&gt;
          &lt;errordoc&gt;
            Not enough heap memory (non shared memory).
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    [the remaining errors were left out for brevity]
  &lt;/errgroup&gt;

&lt;/errorlist&gt;
        </programlisting>
      </sect2>

      <sect2 id="example_python_extended_module">

        <title id='example_python_extended_module.title'>Python extension module</title>

        <para>
          Adding the generated code to an extension module is easy. 
          It requires two steps:
          
          <itemizedlist>
            <listitem>
              <para>
                The fist step is the creation of the the two dict objects.
                using the function in the generated header file. 
                This should be done in the function used to initialize your 
                module or in a function called by the init() function.
              </para>
            </listitem>
            <listitem>
              <para>
                The second step is to add these two new objects to your 
                module using PyModule_AddObject().
              </para>
            </listitem>
          </itemizedlist>
        </para>
        <para>
          Here's a code snippet taken for the pso module; you will have to 
          modify it to suit your needs: 
        </para>
        <programlisting>
# include "errors.h" /* Error Parser generated header file */

PyMODINIT_FUNC
initpso(void) 
{
   PyObject * m = NULL, * tup = NULL, * errs = NULL, * errNames = NULL;
   int rc;
   
   m = Py_InitModule3( "pso", 
                       pso_methods,
                       "Photon module.");
   if (m == NULL) return;

   /* 
    * AddErrors() is defined in errors.h - it creates the two dict objects
    * needed to access the error codes (values and/or symbolic names) and
    * returns them, as a tuple.
    */
   tup = AddErrors(); 
   if ( tup == NULL ) return;
   
   if ( ! PyArg_ParseTuple(tup, "OO", &amp;errs, &amp;errNames) ) return;
   
   /* 
    * errs allows you to do your_module.errs['INVALID_NAME'] in Python to 
    * test for specific errcode without having to hardcode the error number.
    *
    * [example: I use it in tests to make sure that functions in my
    * module return the expected error/exception (on invalid parameters, etc.).
    *
    * Note: You can choose which ever names you want for the 2 dict instead
    *       of the names "errs" and "err_names".
    */
   rc = PyModule_AddObject( m, "errs", errs );
   if ( rc != 0 ) return;
   /*
    * err_names allows you to retrieve the symbolic name of an error
    * from a returned error number (your_module.err_names[err_number]).
    * In some cases, it could be useful (possibly to generate a message
    * in your exception handler?).
    */
   rc = PyModule_AddObject( m, "err_names", errNames );
   if ( rc != 0 ) return;
   
   ...  
        </programlisting>
      </sect2>
    </sect1>
  </chapter>
</book>

