<?xml version='1.0'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN" "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">
<book>

  <title>Error Parser Manual</title>

  <bookinfo>

    <title>Error Parser Manuel</title>

    <author><firstname>Daniel</firstname><surname>Pr&eacute;vost</surname></author>

    <copyright><year>2008</year><holder>Daniel 
    Pr&eacute;vost</holder></copyright>
  </bookinfo>

  <chapter id="Installation">

    <title>Installation</title>

    <para>The installation procedure of the software itself is 
    relatively simple if you use the pre-packaged version of the 
    software (RPM, Inno setup, etc.) or if you build the software from 
    scratch and use make install.</para>

    <para>There are some potential complications however in some cases. 
    For example: this software requires libxml2 - on Unix/Linux, 
    libxml2 will usually already be installed (or you can find packages 
    that will do it painlessly). On Windows, this is often not the case 
    - the Inno Setup installation can installed the run-time 
    environment needed by Error Parser but you may prefer to install 
    everything yourself (this will include the development environment 
    if you want to integrate xml in your application).</para>

    <para>This section will look into installation issues in some 
    details.</para>

    <sect1 id="catalog_linux">

      <title>The xml catalog on Linux/Unix</title>

      <para>The two DTD (Document Type Definition) for Error Parser can 
      be installed in the global xml catalog (usually 
      /etc/xml/catalog). Is this needed? Depends on your exact 
      situation.</para>

      <para>A DTD can be identified using a PUBLIC clause (in the xml 
      file), for example:</para>

      <para>

        <programlisting>&lt;!DOCTYPE errorlist PUBLIC 
   &quot;-//Error Parser project//DTD Error Parser XML V1.2//EN&quot;
    &quot;http://errorparser.sourceforge.net/xml/errorParser12.dtd&quot;&gt;</programlisting>
      </para>

      <para>In this case the DTD will be downloaded from the Error 
      Parser web site.</para>

      <para>You can also use SYSTEM instead:</para>

      <programlisting>&lt;!DOCTYPE errorlist SYSTEM
   &quot;/usr/local/share/xml/errorParser/errorParser12.dtd&quot;&gt;</programlisting>
      <para>Using SYSTEM is perfectly ok if you have a single developer 
      per workstation. If development is done on a shared box however, 
      using the PUBLIC clause is one way to make sure that every 
      developer uses the same copy of the DTD.</para>

      <para>However you don&apos;t want to download the DTD every time 
      you use the software and in this situation, you&apos;ll want to 
      add the Error Parser catalog to the main xml catalog. The program 
      used to do this (xmlcatalog) is included in the libxml2 package. 
      Furthermore a bash script is provided by Error Parser (possibly 
      installed in /usr/local/share/xml/errorParser/install_catalog.sh 
      if Error Parser is installed in /usr/local). You&apos;ll need to 
      edit this script to tailor it for your installation.</para>

      <para>Recommendation: using the SYSTEM clause is perfectly ok and 
      there is likely no real needs to use the xml catalog.</para>

    </sect1>

    <sect1 id="catalog_windows">

      <title>The xml catalog on Windows</title>

      <para>The previous section already discussed the use of PUBLIC or 
      SYSTEM clause for identifying a DTD. The biggest difference 
      between Microsoft Windows and for example Linux, is the absence 
      of a centralized way of managing xml DTD and Schemas - each 
      software manages its XML on its own. It makes even more sense to 
      use SYSTEM here.</para>

      <para>If you still want to install an xml catalog on Windows, the 
      only thing you need to know is that libxml2 uses the environment 
      variable XML_CATALOG_FILES to find the main xml catalog.</para>

      <para>There is an example of a main catalog in the DTD directory 
      (main_catalog_win32.xml). If the main catalog already exists you 
      can use the script DTD\install_catalog.vbs. In both cases you 
      will need to edit the files to tailor them to your 
      installation.</para>

    </sect1>

    <sect1 id="libxml2_windows">

      <title>libxml2 on Windows</title>

      <para>You can find binaries for the complete libxml2 package and 
      other associated packages (libxslt, iconv, etc.) 
      <ulink url="http://www.zlatkovic.com/libxml.en.html">
      here</ulink>. You will need the full package if you build Error 
      Parser from scratch.</para>

      <para>As mentioned previously, the Error Parser package will give 
      you the option of installing the run-time environment needed to 
      run errorParser.exe. This include iconv.exe, iconv.dll, 
      libxml2.dll and xmlcatalog.exe. Do not install them if 
      you&apos;re installing the complete libxml2 package.</para>

    </sect1>

  </chapter>

  <chapter id="building">

    <title>Building the Software</title>

    <para>The only prerequisite software needed to build and run Error 
    Parser is the library libxml2 (the Gnome project xml parser). If it 
    is not installed on your system, you can download it at 
    <ulink url="http://xmlsoft.org/downloads.html">
    xmlsoft.org</ulink>.</para>

    <sect1 id="build_linux_repo">

      <title>Building on Linux/Unix from the repository</title>

      <para>To retrieve the latest version of Error Parser, use the following 
      command:</para>

      <programlisting>svn export https://errorparser.svn.sourceforge.net/svnroot/errorparser/trunk my_local_dir</programlisting>
      <para>Of course, this is a generic command, you can omit the 
      sub-directory <varname>trunk</varname> to retrieve everything 
      (furthermore, if <varname>my_local_dir</varname> is left empty, 
      the current directory will be used).</para>

      <warning>
        <para>
	  The code in the repository is not always stable, be 
          careful (hint: unstable commits will usually have the string
	  "work in progress" included in the commit message).
	</para>
      </warning>

      <para>
        The Error Parser software can also be downloaded by using git 
	(git is a very fast distributed version control system created for the
	Linux kernel).
	Visit <ulink url="http://git.or.cz/index.html">git home page </ulink> 
	for more information on this open-source software.
      </para>
      <para>
        Error Parser uses two external git repositories. They are both kept 
	in sync with the main repository. To retrieve the latest version 
	from github.com, use the following command:
      </para>
      <para>
        git-clone git@github.com:dprevost/errorparser.git my_repo
      </para>
      <para>
        or use the following command to get it from gitorious.org
      </para>
      <para>
        git-clone git@gitorious.org:errorparser/mainline.git my_repo
      </para>
      <warning>
        <para>
	  git was developed for linux and will likely runs without problems on 
	  most Unix systems. On Microsoft Windows however, things might be 
	  different. There are two ports for Windows but I haven't try them (yet).
	</para>
      </warning>
      
      <para>The next step is to run the shell script autogen.sh (in the 
      trunk directory). This will generate everything you need (the 
      makefiles, the configure script). The script will also run 
      configure for you but you might want to rerun it again if you 
      want to change its default options.</para>

      <para>The remaining instructions are identical to the 
      instructions for building the software from a tar file.</para>

    </sect1>

    <sect1 id="build_linux_tar">

      <title>Building on Linux/Unix from the tar file</title>

      <para>Step by step instructions to build the package from a tar 
      file:</para>

      <para>

        <itemizedlist>

          <listitem>

            <para>

              Run configure (./configure). Here is a list of options 
              that you might want to use to tailor the package to your 
              needs (you can use ./configure --help to see all the 
              options):
              <itemizedlist>

                <listitem>

                  <para>--prefix=PREFIX To change the default 
                  installation directory (default is /usr/local). 
                  Example: --prefix=/usr.</para>

                </listitem>

                <listitem>

                  <para>--infodir=DIR   To change the default 
                  installation for info documentation (default is 
                  [PREFIX/info]). Example --infodir=/usr/share/info (or 
                  /usr/local/share/info).</para>

                </listitem>

                <listitem>

                  <para>--mandir=DIR   To change the default 
                  installation for man documentation (default is 
                  [PREFIX/man]). Example --mandir=/usr/share/man (or 
                  /usr/local/share/man).</para>

                </listitem>

              </itemizedlist>

            </para>

          </listitem>

          <listitem>

            <para>make</para>

          </listitem>

          <listitem>

            <para>make check (to run the test suite - optional)</para>

          </listitem>

          <listitem>

            <para>make install</para>

          </listitem>

        </itemizedlist>

      </para>

    </sect1>

    <sect1 id="build_windows_repo">

      <title>Building on Windows from the repository</title>

      <para>If you want to retrieve the software directly from the 
      repository, you will need a subversion client for Windows. 
      <ulink url="http://tortoisesvn.tigris.org/">Tortoise</ulink> is 
      one possible choice. The repository is:</para>

      <programlisting>https://errorparser.svn.sourceforge.net/svnroot/errorparser/trunk</programlisting>

      <warning>
        <para>
	  The code in the repository is not always stable, be 
          careful (hint: unstable commits will usually have the string
	  "work in progress" included in the commit message).
	</para>
      </warning>
      <para>
        The remaining instructions are similar to the instructions 
        for building the software from a zip file.
      </para>

    </sect1>

    <sect1 id="build_windows_zip">

      <title>Building on Windows from a zip file</title>

      <para>Very simple, to build the software, just use the workspace 
      file parser\parser.dsw. If you use a modern version of Visual 
      Studio, it will likely ask you to convert the workspace.</para>

      <para>One additional note: you will need to add the directory for 
      the header files for libxml2 to the list of directories in Visual 
      Studio. For VS 6, you can set this in Options (in the Tools 
      menu).</para>

      <para>To run the tests, from a command shell run cscript 
      RunTests.vbs (in the tests directory). You will also need 
      <ulink url="http://gnuwin32.sourceforge.net/packages/diffutils.htm">
      Gnu diff</ulink> for Windows.</para>

      <para>To build the installation package itself, you will need 
      <ulink url="http://www.jrsoftware.org/isinfo.php">Inno 
      Setup</ulink>. The Inno Setup file is located in 
      installation\errorParser.iss.</para>

    </sect1>

  </chapter>

  <chapter id="user_guide">

    <title>User Guide</title>

    <sect1 id="intro">

      <title>Introduction</title>

      <para>The program errorParser is very easy to use. From the 
      command line just enter:</para>

      <programlisting>errorParser -o <varname>option_file</varname> <varname>error_file</varname></programlisting>
      <para>where <varname>option_file</varname> and 
      <varname>error_file</varname> are the names of two xml files 
      specifying the options and all the data associated with the 
      errors. The real complexity is of course in the xml files 
      themselves. There are examples of these files in the source 
      directory and their syntax is explained below.</para>

    </sect1>

    <sect1 id="xml_file">

      <title>The xml error file</title>

      <para>The xml file starts with the usual xml header (version of 
      xml, encoding of the file, the location of the DTD, etc.). If 
      you&apos;re not familiar with xml and want more information on 
      this, you might want to read additional documentation, for 
      example the website of the 
      <ulink url="http://www.w3schools.com/xml/default.asp">W3 
      Schools</ulink> .</para>

      <para>Each of the xml tag specific to Error Parser is explained 
      in the list below. Unless specified, each tag can only appear 
      once (for each of its parent) and in the order listed here. 
      Example: the &lt;years&gt; tag must be the first sub-tag of 
      &lt;copyright&gt; and must be unique - however, if you have more 
      than one &lt;copyright&gt; tag, each will have its &lt;years&gt; 
      sub-tag.</para>

      <itemizedlist>

        <listitem>

          <para>&lt;errorlist version=&quot;0.3&quot;&gt; <indexterm>
          <primary>errorlist</primary></indexterm></para>

          <para>This tag starts the document itself. The version 
          attribute is a string of your choosing and is there to help 
          you synchronize your work (to make sure that the output files 
          match the version of your software, for example). This 
          attribute is optional.</para>

        </listitem>

        <listitem>

          <para>&lt;copyright_group&gt; <indexterm>
          <primary>copyright_group</primary></indexterm></para>

          <para>This is an optional tag. You use it if you want to 
          generate copyright information in the output files. This tag 
          has only one sub-tag, &lt;copyright&gt;, which can be 
          repeated multiple times (if you have multiple authors with 
          possibly different licenses).</para>

          <para>Note: from an xml point of view, this tag is unneeded - 
          the &lt;copyright&gt; tag could be used directly without this 
          &quot;dummy&quot; container. However, the code of errorParser 
          is simplify because of it, so...</para>

        </listitem>

        <listitem>

          <para>&lt;copyright&gt; <indexterm>
          <primary>copyright</primary></indexterm></para>

          <para>Allows you to enter copyright information in the output 
          files. It has multiple sub-tags. As mentioned previously, 
          multiple &lt;copyright&gt; tags are allowed.</para>

          <itemizedlist>

            <listitem>

              <para>&lt;years&gt; <indexterm>
              <primary>years</primary></indexterm></para>

              <para>The interval of years for the current copyright 
              notice.</para>

            </listitem>

            <listitem>

              <para>&lt;authors&gt; <indexterm>
              <primary>authors</primary></indexterm></para>

              <para>The name(s) of the owner(s) of the copyright.</para>

            </listitem>

            <listitem>

              <para>&lt;notice&gt; <indexterm>
              <primary>notice</primary></indexterm></para>

              <para>The text of the license. More exactly, a paragraph 
              of the license. Use multiple &lt;notice&gt; if your 
              license has multiple paragraphs. You must have at least 
              one &lt;notice&gt; for each &lt;copyright&gt;.</para>

            </listitem>

          </itemizedlist>

        </listitem>

        <listitem>

          <para>&lt;errgroup&gt; <indexterm>
          <primary>errgroup</primary></indexterm></para>

          <para>&lt;errgroup&gt; is used to organize your errors in 
          groups, if you so desired (for example, a group of i/o 
          errors, a group of network errors, etc). You can have 
          multiple &lt;errgroup&gt;, you must have at least one.</para>

          <para>If you don&apos;t want to use this feature, only use a 
          single group and do not include the &lt;errgroup_ident&gt; 
          sub-tag.</para>

        </listitem>

        <listitem>

          <para>&lt;errgroup_ident&gt; <indexterm>
          <primary>errgroup_ident</primary></indexterm></para>

          <para>This sub-tag of &lt;errgroup&gt; is optional. The 
          sub-tags associated with this tag are used to generate 
          comments in your output header file (and will be used to 
          generate the docbook documentation eventually).</para>

          <para>You can have multiple &lt;errgroup_ident&gt; - one for 
          each language supported by your application. This is done 
          with an optional attribute, xml:lang. If the xml:lang 
          attribute is missing the default attribute will be used 
          (currently &apos;en&apos; but you can modify the shipped DTD 
          to use a different default tailored for your needs).</para>

          <para>Note: the parser will use the first 
          &lt;errgroup_ident&gt; matching the language selected in the 
          option file. If the selected language is not found, the first 
          &lt;errgroup_ident&gt; is used.</para>

          <itemizedlist>

            <listitem>

              <para>&lt;errgroup_name&gt; <indexterm>
              <primary>errgroup_name</primary></indexterm></para>

              <para>A name for this group of errors. For example, 
              Network errors.</para>

            </listitem>

            <listitem>

              <para>&lt;errgroup_desc&gt; <indexterm>
              <primary>errgroup_desc</primary></indexterm></para>

              <para>Description of this group of errors. You must have 
              at least one &lt;errgroup_desc&gt; but you can have 
              multiple ones, as needed. Each will be mapped to a 
              paragraph.</para>

            </listitem>

          </itemizedlist>

        </listitem>

        <listitem>

          <para>&lt;error&gt; <indexterm>
          <primary>error</primary></indexterm></para>

          <para>This tag is also a sub-tag of &lt;errgroup&gt;. You 
          need at least one &lt;error&gt; for each &lt;errgroup&gt; but 
          you can have as many as needed.</para>

          <itemizedlist>

            <listitem>

              <para>&lt;errnumber&gt; <indexterm>
              <primary>errnumber</primary></indexterm></para>

              <para>The numerical value of the error code.</para>

            </listitem>

            <listitem>

              <para>&lt;errname&gt; <indexterm>
              <primary>errname</primary></indexterm></para>

              <para>The generic name of the error. This name is going 
              to be used to generate either an enum entry or a #define 
              in the output header file.</para>

              <para>Note: if you add a prefix to your errors (to avoid 
              namespace conflicts), it is recommended to leave the 
              prefix out. For example, VDS_OBJECT_IS_DELETED would 
              become &lt;errname&gt; OBJECT_IS_DELETED &lt;/errname&gt; 
              - the prefix can be added by specifying it in the option 
              file.</para>

            </listitem>

            <listitem>

              <para>&lt;message_group&gt; <indexterm>
              <primary>message_group</primary></indexterm></para>

              <para>This tag is used to group the error messages and 
              the documentation for the error - which are encapsulated 
              in the &lt;message&gt; tag. Multiple &lt;message&gt; tags 
              are supported (you must have at least one), one for each 
              supported language.</para>

              <para>Note: from an xml point of view, this tag is 
              unneeded - the &lt;message&gt; tag could be used directly 
              without this &quot;dummy&quot; container. However, the 
              code of errorParser is simplify because of it, 
              so...</para>

            </listitem>

            <listitem>

              <para>&lt;message&gt; <indexterm>
              <primary>message</primary></indexterm></para>

              <para>Container for both the error message and the 
              documentation for this error. This tag has an optional 
              attribute, xml:lang.If the xml:lang attribute is missing 
              the default attribute will be used (currently 
              &apos;en&apos; but you can modify the shipped DTD to use 
              a different default tailored for your needs).</para>

              <para>You must have at least one &lt;message&gt;, 
              multiple ones are supported (one per language used in 
              your application).</para>

              <para>Note: the parser will use the first &lt;message&gt; 
              matching the language selected in the option file. If the 
              selected language is not found, the first &lt;message&gt; 
              is used.</para>

              <itemizedlist>

                <listitem>

                  <para>&lt;errormsg&gt; <indexterm>
                  <primary>errormsg</primary></indexterm></para>

                  <para>The text of the error message that will be 
                  retrieved by the function 
                  <emphasis>yourprefix_ErrorMessage()</emphasis>.</para>

                  <para>Note: the inclusion of some characters 
                  (&apos;%&apos; for example) or chain of characters 
                  (escape sequences) might be problematic. You can 
                  control how to handle these occurrences by setting 
                  the appropriate options in the option file.</para>

                </listitem>

                <listitem>

                  <para>&lt;errordoc&gt; <indexterm>
                  <primary>errordoc</primary></indexterm></para>

                  <para>Each &lt;errordoc&gt; is a paragraph of the 
                  documentation. Therefore, you can have multiple 
                  &lt;errordoc&gt;. You must have at least one.</para>

                </listitem>

              </itemizedlist>

            </listitem>

          </itemizedlist>

        </listitem>

      </itemizedlist>

      <para />

    </sect1>

    <sect1 id="option_file">

      <title>The xml option file file</title>

      <para>The number of potential options to the program errorParser 
      was getting quite large and it made more sense to put all these 
      options in a configuration file (written in xml). These options 
      are described below.</para>

      <itemizedlist>

        <listitem>

          <para>&lt;options&gt; <indexterm>
          <primary>options</primary></indexterm></para>

          <para>The root element.</para>

        </listitem>

        <listitem>

          <para>&lt;enumname&gt; <indexterm>
          <primary>enumname</primary></indexterm></para>

          <para>Optional. The name of the enum. If absent, #define will 
          be generated instead.</para>

        </listitem>

        <listitem>

          <para>&lt;header_name_dir&gt; <indexterm>
          <primary>header_name_dir</primary></indexterm></para>

          <para>Optional. The name of the directory where the error 
          header file is to be created. If absent, the current 
          directory will be used.</para>

          <para>Alternatively, you can put the directory name (or part 
          of the directory name) directly in the &lt;header_name&gt; 
          tag. But if you do, the &quot;guard&quot; will include that 
          directory name (guard: the small preprocessor code use to 
          avoid including the same header file twice).</para>

          <para>Example: the output file name is 
          <emphasis>my_dir/my_sub_dir/my_sub_project/errors.h</emphasis> 
          and you want to include <emphasis>my_sub_project</emphasis> 
          in the guard. The option file would look like:</para>

          <para>

            <programlisting>&lt;header_name_dir&gt;my_dir/my_sub_dir&lt;/header_name_dir&gt;
&lt;header_name&gt;my_sub_project/errors.h&lt;/header_name&gt;</programlisting>
          </para>

          <para>The generated guard would look like this:</para>

          <para>

            <programlisting>#ifndef MY_SUB_PROJECT_ERRORS_H
#define MY_SUB_PROJECT_ERRORS_H
...
#endif /* MY_SUB_PROJECT_ERRORS_H */</programlisting>
          </para>

        </listitem>

        <listitem>

          <para>&lt;header_name&gt; <indexterm>
          <primary>header_name</primary></indexterm></para>

          <para>The name of the header file for errors. See the 
          previous discussion (&lt;header_name_dir&gt;) for more 
          details.</para>

        </listitem>

        <listitem>

          <para>&lt;errmsg_dir&gt; <indexterm>
          <primary>errmsg_dir</primary></indexterm></para>

          <para>Optional. The name of the directory where the header 
          file and &quot;C&quot; file (for the code to retrieve the 
          error messages) will be created. If absent, the current 
          directory will be used.</para>

          <para>See the previous discussion (&lt;header_name_dir&gt;) 
          for more details.</para>

        </listitem>

        <listitem>

          <para>&lt;errmsg_header_name&gt; <indexterm>
          <primary>errmsg_header_name</primary></indexterm></para>

          <para>The name of the header file for the code to retrieve 
          the error messages. See the previous discussion 
          (&lt;header_name_dir&gt;) for more details.</para>

        </listitem>

        <listitem>

          <para>&lt;errmsg_c_name&gt; <indexterm>
          <primary>errmsg_c_name</primary></indexterm></para>

          <para>The name of the &quot;C&quot; file for the code to 
          retrieve the error messages. See the previous discussion 
          (&lt;header_name_dir&gt;) for more details.</para>

        </listitem>

        <listitem>

          <para>&lt;prefix_error&gt; <indexterm>
          <primary>prefix_error</primary></indexterm></para>

          <para>
            The prefix to be used for the error codes (enum or 
            #define). For example, if your error is OBJECT_IS_DELETED 
            (using the &lt;errname&gt; tag) and your prefix is VDS, the error
            code becomes VDS_OBJECT_IS_DELETED.
          </para>
          <para>
            The prefix should be optional (and if empty the underscore should
            not be added). This was added on the to-do list for the next 
            release.
          </para>
          
        </listitem>

        <listitem>

          <para>&lt;prefix_variable&gt; <indexterm>
          <primary>prefix_variable</primary></indexterm></para>

          <para>The prefix to be used for all variables in the code to 
          retrieve the error messages.</para>

        </listitem>

        <listitem>

          <para>&lt;err_msg&gt; <indexterm>
          <primary>err_msg</primary></indexterm></para>

          <para>This tag has no content but its attributes are 
          important - they define the allowed characteristics (and the 
          transformations, if needed of the error messages defined in 
          the xml error file (&lt;errormsg&gt;).</para>

          <para>The problem: the generated C strings will be use, 
          eventually, by standard C/C++ libraries and some sequence of 
          characters could have some bad side effects (possibly some 
          security issues?). The most problematic issue is likely the 
          %symbol - it is interpreted differently by libc (printf()) 
          and the iostream library (cout).</para>

          <para>The attributes:</para>

          <itemizedlist>

            <listitem>

              <para>allow_escapes <indexterm>
              <primary>allow_escapes</primary><secondary>escape</secondary></indexterm></para>

              <para>An enumeration with two values, yes and no. The 
              default is no, escape sequences are not permitted (a more 
              fine grain approach could be written if the need 
              arise).</para>

            </listitem>

            <listitem>

              <para>allow_quotes <indexterm>
              <primary>allow_quotes</primary><secondary>quotes</secondary></indexterm></para>

              <para>An enumeration with two values, yes and no. The 
              default is yes, quotes (&apos; and &quot;) are allowed 
              (and will be escaped as needed).</para>

            </listitem>

            <listitem>

              <para>percent <indexterm>
              <primary>percent</primary></indexterm></para>

              <para>The text to use to replace the % symbol. No 
              default. I recommend the textual 
              &quot;percent&quot;.</para>

            </listitem>

          </itemizedlist>

        </listitem>

      </itemizedlist>
            
      </sect1>
<sect1 id="watchdog">
  <title>Example: the VDSF watchdog</title>
  <para>
    This is work in progress for the next iteration of the VDSF project. As a
    matter of fact, while working on this, I've discovered that adding
    new error codes this way was no more complex than adding error codes 
    to an header file (once you understand the basics).
  </para>
    
  <sect2 id="makefile_am">
<title>Makefile.am</title>

       <para>
         How to include this in a project? Here's an example of how I've 
         included it in the Makefile.am of the VDSF Watchdog (the syntax for
         ordinary makefiles should be similar).
       </para>
       
<programlisting># The main target, vdswd
bin_PROGRAMS = vdswd

# The list of files generated by errorParser.
OUTPUT_FILES =           \
        wdErrors.h       \
        wdErrorHandler.c \
        wdErrorHandler.h 

# This is "true" if the autoconf program found errorParser. Otherwise
# we will not attempt to redo the generated files.
if COND_USE_ERRORPARSER
$(OUTPUT_FILES): wdOptions.xml wdErrors.xml
	errorParser --options wdOptions.xml wdErrors.xml
endif

# The source code needed to build the watchdog. We list the errorParser 
# generated files first since they must be "refreshed" first since they
# might be used in the rest of the code (certainly true for wdErrors.h).
vdswd_SOURCES =         \
        $(OUTPUT_FILES) \
        Acceptor.cpp    \
        ...
</programlisting>
</sect2>

<sect2 id="wderrors">
<title>wdErrors.xml</title>
<programlisting>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE errorlist PUBLIC "-//Error Parser project//DTD Error Parser XML V1.2//EN"
             "http://errorparser.sourceforge.net/xml/errorParser12.dtd"&gt; 
&lt;!-- 
    This file contains the error codes specific to the watchdog of
    VDSF.
    
    You can replace the DOCTYPE with this, if you prefer:
&lt;!DOCTYPE errorlist SYSTEM 
             "/usr/local/share/xml/errorParser/DTD/errorParser12.dtd"&gt;
    
--&gt;

&lt;!-- VDSF next version is 0.3 --&gt;
&lt;errorlist version="0.3"&gt;
  &lt;!-- Copyright information and any additional info that will appear at 
       the top of the generated files. This is optional. --&gt;
  &lt;copyright_group&gt;
    &lt;copyright&gt;
      &lt;years&gt;2006-2008&lt;/years&gt;
      &lt;authors&gt;Daniel Prevost&lt;/authors&gt;
      &lt;!-- Each &lt;notice&gt; is mapped to a paragraph (easier to read) --&gt;
      &lt;notice&gt;
        This file is part of the vdsf library (Virtual Data Space Framework).
      &lt;/notice&gt;
      &lt;!-- The GPL license is of course for VDSF, not for Error Parser... --&gt;
      &lt;notice&gt;
        This file may be distributed and/or modified under the terms of the
        GNU General Public License version 2 as published by the Free Software
        Foundation and appearing in the file COPYING included in the
        packaging of this library.
      &lt;/notice&gt;
      &lt;notice&gt;
        This library is distributed in the hope that it will be useful,
        but WITHOUT ANY WARRANTY; without even the implied warranty of
        MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. 
      &lt;/notice&gt;
    &lt;/copyright&gt;
  &lt;/copyright_group&gt;
  &lt;errgroup&gt;
    &lt;error&gt;
      &lt;errnumber&gt; 0 &lt;/errnumber&gt;
      &lt;errname&gt; OK &lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;No error...&lt;/errormsg&gt;
          &lt;errordoc&gt;No error...&lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;
  &lt;/errgroup&gt;
  &lt;errgroup&gt;
    &lt;errgroup_ident xml:lang="en"&gt;
      &lt;errgroup_name&gt;XML config errors&lt;/errgroup_name&gt;
      &lt;errgroup_desc&gt;
        This group of errors described potential errors with the code to read
        and parse the XML configuration file.
      &lt;/errgroup_desc&gt;
    &lt;/errgroup_ident&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 100 &lt;/errnumber&gt;
      &lt;errname&gt; XML_CONFIG_NOT_OPEN&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Error opening the XML config file.&lt;/errormsg&gt;
          &lt;errordoc&gt;Error opening the XML configuration file.&lt;/errordoc&gt;
          &lt;errordoc&gt;
            Most likely reason: the file does not exist but it might also be
            a problem with access permissions (on the file itself or one
            of its parent directories.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 101 &lt;/errnumber&gt;
      &lt;errname&gt; XML_READ_ERROR&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Error reading the XML config file.&lt;/errormsg&gt;
          &lt;errordoc&gt;Error reading the XML configuration file.&lt;/errordoc&gt;
          &lt;errordoc&gt;
            No validation is done at this point. Therefore the error is likely
            something like a missing end-tag or some other non-conformance to 
            the XML's syntax rules. 
          &lt;/errordoc&gt;
          &lt;errordoc&gt;
            A simple Google search for "well-formed xml" returns many web sites 
            that describe the syntax rules for XML. You can also use the 
            program xmllint (included in the distribution of libxm2) to
            pinpoint the issue.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 102 &lt;/errnumber&gt;
      &lt;errname&gt; XML_NO_ROOT&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;No root element in the XML document.&lt;/errormsg&gt;
          &lt;errordoc&gt;No root element in the XML document.&lt;/errordoc&gt;
          &lt;errordoc&gt;
            This error is very unlikely - without a root element, the document
            cannot be parsed into a tree and you'll get the error 
            XML_READ_ERROR instead.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 103 &lt;/errnumber&gt;
      &lt;errname&gt; XML_INVALID_ROOT&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;The root element is not the expected root.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The root element is not the expected root, &lt;vdsf_config&gt;.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 104 &lt;/errnumber&gt;
      &lt;errname&gt; XML_NO_SCHEMA_LOCATION&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;The attribute xsi:schemaLocation was not found.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The root element must have an attribute named schemaLocation (in 
            the namespace "http://www.w3.org/2001/XMLSchema-instance") to
            point to the schema use for the watchdog configuration file.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 105 &lt;/errnumber&gt;
      &lt;errname&gt; XML_MALFORMED_SCHEMA_LOCATION&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;The attribute xsi:schemaLocation is not well formed.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The attribute schemaLocation of the root element 
            should contain both the namespace and the location of the 
            schema file, separated by a space. You'll get this error if
            the white space is not found.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 106 &lt;/errnumber&gt;
      &lt;errname&gt; XML_PARSER_CONTEXT_FAILED&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;The creation of a new schema parser context failed.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The creation of a new schema parser context failed. There might
            be multiple reasons for this, for example, a memory-allocation
            failure in libxml2. However, the most likely reason is that the
            schema file is not at the location indicated by the attribute 
            schemaLocation of the root element of the config file.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 107 &lt;/errnumber&gt;
      &lt;errname&gt; XML_PARSE_SCHEMA_FAILED&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Failure when parsing the XML schema for config.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The parse operation of the schema failed. Most likely, there
            is an error in the schema for the configuration. To debug this
            you can use xmllint (part of the libxml2 package).
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 108 &lt;/errnumber&gt;
      &lt;errname&gt; XML_VALID_CONTEXT_FAILED&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;The creation of a new XML Schemas validation context failed.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The creation of a new schema validation context failed. There might
            be multiple reasons for this, for example, a memory-allocation
            failure in libxml2.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 109 &lt;/errnumber&gt;
      &lt;errname&gt; XML_VALIDATION_FAILED&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Document validation for the config file failed.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            Document validation for the config file failed. To debug this
            problem you can use xmllint (part of the libxml2 package).
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 110 &lt;/errnumber&gt;
      &lt;errname&gt; CFG_VDS_LOCATION_TOO_LONG&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Config: vds_location is too long.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The path associated with the tag &lt;vds_location&gt; is longer 
            than PATH_MAX (the maximum length of a filename/pathname).
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 111 &lt;/errnumber&gt;
      &lt;errname&gt; CFG_VDS_LOCATION_IS_MISSING&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Config: vds_location is missing.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The tag &lt;vds_location&gt; is missing. This would normally
            be caught when the configuration is validated using the schema 
            unless of course there is a bug in the code or the schema
            itself was modified.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 112 &lt;/errnumber&gt;
      &lt;errname&gt; CFG_MEM_SIZE_IS_MISSING&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Config: mem_size is missing.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The tag &lt;mem_size&gt; is missing. This would normally
            be caught when the configuration is validated using the schema 
            unless of course there is a bug in the code or the schema
            itself was modified.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 113 &lt;/errnumber&gt;
      &lt;errname&gt; CFG_SIZE_IS_MISSING&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Config: mem_size:size is missing.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The attribute "size" of the tag &lt;mem_size&gt; is missing. 
            This would normally be caught when the configuration is 
            validated using the schema unless of course there is a bug 
            in the code or the schema itself was modified.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 114 &lt;/errnumber&gt;
      &lt;errname&gt; CFG_UNITS_IS_MISSING&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Config: mem_size:units is missing.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The attribute "units" of the tag &lt;mem_size&gt; is missing. 
            This would normally be caught when the configuration is 
            validated using the schema unless of course there is a bug 
            in the code or the schema itself was modified.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 115 &lt;/errnumber&gt;
      &lt;errname&gt; CFG_WATCHDOG_ADDRESS_IS_MISSING&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Config: watchdog_address is missing.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The tag &lt;watchdog_address&gt; is missing. This would normally
            be caught when the configuration is validated using the schema 
            unless of course there is a bug in the code or the schema
            itself was modified.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 116 &lt;/errnumber&gt;
      &lt;errname&gt; CFG_FILE_ACCESS_IS_MISSING&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Config: file_access is missing.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The tag &lt;file_access&gt; is missing. This would normally
            be caught when the configuration is validated using the schema 
            unless of course there is a bug in the code or the schema
            itself was modified.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

    &lt;error&gt;
      &lt;errnumber&gt; 117 &lt;/errnumber&gt;
      &lt;errname&gt; CFG_ACCESS_IS_MISSING&lt;/errname&gt;
      &lt;message_group&gt;
        &lt;message xml:lang="en"&gt;
          &lt;errormsg&gt;Config: file_access:access is missing.&lt;/errormsg&gt;
          &lt;errordoc&gt;
            The attribute "access" of the tag &lt;file_access&gt; is missing. 
            This would normally be caught when the configuration is 
            validated using the schema unless of course there is a bug 
            in the code or the schema itself was modified.
          &lt;/errordoc&gt;
        &lt;/message&gt;
      &lt;/message_group&gt;
    &lt;/error&gt;

  &lt;/errgroup&gt;

&lt;/errorlist&gt;
</programlisting>
</sect2>
<sect2 id="wdoptions">
<title>wdOptions.xml</title>
<programlisting>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE options SYSTEM 
             "/usr/local/share/xml/errorParser/errorParserOptions10.dtd"&gt;

&lt;options&gt;
  &lt;!-- The name of the enum. If absent, #define will be generated instead. --&gt;
  &lt;enumname&gt; vdswErrors&lt;/enumname&gt;
  &lt;!-- Name of the output dir for the error header file. If absent, the 
       current directory will be used.
       
       Alternatively, you can put the directory directly in the header_name 
       element. But if you do, the "GUARD" will use that directory name.
  &lt;header_name_dir&gt;  &lt;/header_name_dir&gt; --&gt;
  &lt;!-- The file name for the .h file which will hold the errors. --&gt;
  &lt;header_name&gt; wdErrors.h &lt;/header_name&gt;
  &lt;!-- Name of the output dir for the code to retrieve the error messages. 
       If absent, the current directory will be used.

       Alternatively, you can put the directory directly in the 2 
       "errmsg_*_name" elements. If you do, the "GUARD" will use that 
       directory name and the .c file will include the header using the 
       full name (errmsg_header_name) 
   &lt;errmsg_dir&gt; ../Engine &lt;/errmsg_dir&gt; --&gt;
  &lt;!-- The file name for the .h file for the code to retrieve the error 
       messages. --&gt;
  &lt;errmsg_header_name&gt; wdErrorHandler.h &lt;/errmsg_header_name&gt;
  &lt;!-- The file name for the .c file for the code to retrieve the error 
       messages. --&gt;
  &lt;errmsg_c_name&gt; wdErrorHandler.c &lt;/errmsg_c_name&gt;
  &lt;!-- Prefix to be used for the error codes (enum or #define). --&gt;
  &lt;prefix_error&gt; VDSW &lt;/prefix_error&gt;
  &lt;!-- Prefix to be used for all variables in the code to retrieve the 
       error messages --&gt;
  &lt;prefix_variable&gt; vdsw &lt;/prefix_variable&gt;
  &lt;!-- How to handle the error message. The problem: the generated C strings
       will be use, eventually, by standard C/C++ libraries and some 
       sequence of characters could have some bad side effects, possibly
       including security issues.
       The defaults:
         - escape sequences are not permitted (a more fine grain approach
           could be written if the need arise).
         - quotes (' and ") are allowed (and will be escaped as needed) 
         - The % symbol. No default. I recommend the textual "percent" 
           (% is the most problematic one, IMHO. %d %p, etc are interpreted
           differently by libc (printf()) and the iostream library (cout) --&gt;         
  &lt;err_msg percent="percent" /&gt;
  &lt;selected_lang xml:lang="en" /&gt;
&lt;/options&gt;

</programlisting>

</sect2>

        </sect1>
      
  </chapter>

</book>

